<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		<%= title %>
	</title>
	<!-- stylesheet -->
	<link rel="stylesheet" href="https://unpkg.com/@material-tailwind/html@latest/styles/material-tailwind.css" />

	<!-- script -->

	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<!-- from node_modules -->

	<!-- from cdn -->
	<script src="https://unpkg.com/@material-tailwind/html@latest/scripts/dialog.js"></script>
	<style>
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f7f7f7;
			color: #333;
		}

		header {
			background-color: #4caf50;
			color: #fff;
			text-align: center;
			padding: 1rem;
		}

		section {
			/* max-width: 800px; */
			margin: 2rem;
			padding: 2rem;
			border-radius: 8px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		}

		h2 {
			color: #4caf50;
		}

		h1 {
			font-size: 2.5rem;
		}

		p {
			line-height: 1.6;
		}

		footer {
			background-color: #333;
			color: #fff;
			text-align: center;
		}

		.btn-orchids {
			width: 12rem;
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 10px 20px;
			margin-bottom: 1rem;
			background-color: #4caf50;
			color: #fff;
			text-decoration: none;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 1.2rem;
		}

		.btn-orchids:hover {
			background-color: #45a049;
		}

		/* .btn-actions {
			
		} */

		.btn-action:hover {
			background-color: rgb(34 197 94 / 0.3);
		}

		.btn-danger:hover {
			background-color: rgba(197, 34, 34, 0.3);
			color: red
		}

		.btn-disabled:disabled {
			background-color: gray;
		}
	</style>
</head>

<body>
	<%- include('_header') %>

		<section class="bg-white">
			<div class="flex justify-start">
				<a href="/" class="btn-orchids font-semibold bg-gradient-to-tr" data-ripple-light="true"
					data-dialog-target="dialog-create">
					<span class="material-symbols-outlined">
						arrow_back_ios
					</span>
					<span>Back to home</span>
				</a>
			</div>
			<div
				class="relative flex bg-clip-border rounded-xl bg-white text-gray-700 shadow-md w-full max-w-[48rem] flex-row border-2">
				<div
					class="relative w-2/5 m-0 overflow-hidden text-gray-700 bg-white rounded-r-none bg-clip-border rounded-xl shrink-0">
					<img src=<%=orchid.image %> alt="card-image" class="object-cover w-full h-full" />
				</div>
				<div class="p-6">
					<h1
						class="block mb-2 font-sans text-3xl antialiased font-semibold leading-snug tracking-normal text-blue-gray-900">
						<%=orchid.name%>
							</h3>
							<p class="block mt-3 font-sans text-xl antialiased font-normal leading-relaxed text-gray-700">
								Category: <%=orchid.category.name %>
							</p>
							<p class="block mt-3 font-sans text-xl antialiased font-normal leading-relaxed text-gray-700">
								Price: $<%=orchid.price %>
							</p>
							<p class="block mt-3 font-sans text-xl antialiased font-normal leading-relaxed text-gray-700">
								Origin: <%=orchid.original %>
							</p>
							<p class="block mt-3 font-sans text-xl antialiased font-normal leading-relaxed text-gray-700">
								Natural: <%=orchid.isNatural %>
							</p>
							<p class="block mt-3 font-sans text-xl antialiased font-normal leading-relaxed text-gray-700">
								Color: <%=orchid.color %>
							</p>
				</div>

			</div>
			<div class="py-8">
				<h1
					class="block mb-2 font-sans text-3xl antialiased font-semibold leading-snug tracking-normal text-blue-gray-900">
					Comment section:
				</h1>
				<% if(user) { %>
					<form action="/orchid/<%=orchid.id%>/comment" method="post">
						<input id="userId" name="userId" type="hidden" value=<%=user.id%> >
						<div class="flex flex-col gap-4 mb-1">
							<h6 class="block font-sans text-base antialiased font-semibold leading-relaxed tracking-normal italic">
								Commnet as <span class="underline text-green-700">
									<%= user.username %>
								</span>
							</h6>
							<div class="relative gap-4 w-1/2 flex flex-col items-end">
								<textarea placeholder="Leave a comment" type="text" id="comment" name="comment" required
									class="w-full rounded-md border-2 border-green-200 bg-transparent px-3 py-3 font-sans font-normal text-blue-gray-700 outline outline-0 transition-all placeholder-shown:border placeholder-shown:border-green-200 placeholder-shown:border-t-blue-gray-200 focus:border-2 focus:border-gray-900 disabled:border-0 disabled:bg-blue-gray-50"></textarea>
								<div class="flex gap-10">

									<div class="flex gap-4 items-center">
										<h6
											class="block font-sans text-base antialiased font-semibold leading-relaxed tracking-normal text-green-900">
											Rating:
										</h6>
										<select id="rating" name="rating"
											class="bg-gray-50 border-2 border-green-200 bg-transparent text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
											<option value="1">1</option>
											<option value="2">2</option>
											<option value="3">3</option>
											<option value="4">4</option>
											<option value="5">5</option>
										</select>
									</div>
									<button data-ripple-light="true" class="btn-disabled middle none center rounded-lg bg-gradient-to-tr from-green-600 to-green-400 py-3
									px-6 font-sans font-bold uppercase text-white shadow-md shadow-green-500/20 transition-all
									hover:shadow-lg hover:shadow-green-500/40 active:opacity-[0.85] disabled:pointer-events-none
									disabled:opacity-50 disabled:shadow-none">
										Comment
									</button>
								</div>
							</div>

						</div>
					</form>
					<% }%>
						<% if(!user) { %>
							<div class="text-lg">Please <a class="underline" href="/users/login">login</a> to comment.</div>
							<%}%>
								<div>

									<% if(orchid.comments.length) {%>
									<div
										class="relative flex w-full max-w-[26rem] flex-col rounded-xl bg-transparent bg-clip-border text-gray-700 shadow-none">
										<div
											class="relative flex items-center gap-4 pt-0 mx-0 mt-4 overflow-hidden text-gray-700 bg-transparent shadow-none rounded-xl bg-clip-border">
											<img src="https://images.nightcafe.studio//assets/profile.png?tr=w-1600,c-at_max"
												alt="Tania Andrew"
												class="relative inline-block w-16 h-16 !rounded-full  object-cover object-center" />
											<div class="flex w-full flex-col gap-0.5">
												<div class="flex flex-col">
													<h5
														class="block font-sans text-xl antialiased font-semibold leading-snug tracking-normal text-blue-gray-900">
														<%=orchid.comments[0]?.author?.username%>
													</h5>
													<div class="flex items-center gap-0 5">
														<% Array.from({length: orchid.comments[0]?.rating || 1}).forEach(_ => { %>
														<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
															class="w-5 h-5 text-yellow-700">
															<path fill-rule="evenodd"
																d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z"
																clip-rule="evenodd"></path>
														</svg>
														<% })%>
													</div>
												</div>
											</div>
										</div>
										<div class="pt-2">
											<%= orchid.comments[0]?.comment %>
										</div>
									</div>
								<% } %>
								</div>
			</div>
			
		</section>
		<!-- <footer class="w-screen">
		&copy; 2024 Your Flower Shop. All rights reserved
	</footer> -->
		<script>
			function setEditOrchid(editOrchid) {
				const { id, name, image, price, original, isNatural, color } = editOrchid
				console.log(editOrchid)
				document.getElementById('id-edit').value = id;
				document.getElementById('name-edit').value = name;
				document.getElementById('image-edit').value = image;
				document.getElementById('price-edit').value = price;
				document.getElementById('original-edit').value = original;
				document.getElementById('isNatural-edit').checked = JSON.parse(isNatural.toLowerCase());
				document.getElementById('color-edit').value = color;

			}

			function editOrchid() {
				const userConfirmed = window.confirm('Are you sure you want to edit this orchid?');
				if (!userConfirmed) return;
				// Access form elements using the DOM
				const id = document.getElementById('id-edit').value;
				const name = document.getElementById('name-edit').value;
				const image = document.getElementById('image-edit').value;
				const price = document.getElementById('price-edit').value;
				const original = document.getElementById('original-edit').value;
				const isNatural = document.getElementById('isNatural-edit').checked;
				const color = document.getElementById('color-edit').value;

				// Create an object with the form data
				const formData = {
					name: name,
					image: image,
					price: price,
					original: original,
					isNatural: isNatural,
					color: color,
				};

				// Create a new XMLHttpRequest object
				const xhr = new XMLHttpRequest();

				// Configure it: POST-request for the URL "https://localhost:5000/orchids"
				xhr.open('PUT', `https://localhost:5000/orchids/${id}`, true);

				// Set the request header to indicate the content type is JSON
				xhr.setRequestHeader('Content-Type', 'application/json');

				// Set up a callback function to handle the response
				xhr.onload = function () {
					if (xhr.status >= 200 && xhr.status < 300) {
						// If the request was successful, log the response
						console.log('Response:', xhr.responseText);
						window.location.href = `https://localhost:5000/orchids/${id}`;
					} else {
						// Handle the error
						alert(`Error: ${xhr.responseText}`)
						console.error('Error:', xhr.statusText);
					}
				};

				// Convert the formData object to JSON and send it in the request body
				const jsonData = JSON.stringify(formData);
				xhr.send(jsonData);
			}


			function deleteOrchid(id) {
				const userConfirmed = window.confirm('Are you sure you want to delete this orchid?');
				if (!userConfirmed) return;

				const xhr = new XMLHttpRequest();

				xhr.open('DELETE', `https://localhost:5000/orchids/${id}`, true);

				xhr.onload = function () {
					if (xhr.status >= 200 && xhr.status < 300) {
						console.log('Response:', xhr.responseText);
						window.location.href = "https://localhost:5000/orchids";
					} else {
						// If there was an error, call the error callback
						console.error('Error:', xhr.statusText);
					}
				};

				// Send the DELETE request
				xhr.send();
			}
		</script>

		<script src="https://unpkg.com/@material-tailwind/html@latest/scripts/script-name.js"></script>
		<script src="https://unpkg.com/@material-tailwind/html@latest/scripts/dialog.js"></script>
		<script src="https://unpkg.com/@material-tailwind/html@latest/scripts/ripple.js"></script>

</body>

</html>